<div class="row">
  <div class="col-lg-12">
    <h3 class="page-title">
      <%= t(".title") %>
    </h3>
    <%= form_tag cost_split_human_resources_path, method: :get, class: 'form-inline' do -%>
      <div class="form-group">
        <label class="mr-1"><%= t(".company_name") -%>：</label>
        <%= select_tag 'company_name', options_for_select(@all_company_names, @company_name), class: 'form-control-plaintext form-control', data: { remote: true, type: :script, url: url_for(controller: 'cost_split/human_resources', action: 'change_company', format: 'js')} -%>
      </div>
      <div class="form-group mr-3">
        <label class="mr-1"><%= t(".dept_name") -%>：</label>
          <%= select_tag 'depts', options_for_select(@dept_options, @depts), { id: 'hr-depts-select', include_blank: true, multiple: true, class: 'form-control' } %>
      </div>
      <div><%= submit_tag t(".confirm"), class: 'btn btn-primary' %></div>
    <% end -%>

    <div class="row mt-2">
      <div class="col-lg-12">
        <table class="table table-bordered table-responsive pb-5">
          <thead>
            <tr>
              <th width="150px"><%= t(".table.clerk_people") -%></th>
              <th width="80px"><%= t(".table.split_type") -%></th>
              <th width="80px"><%= t(".table.split_rate") -%></th>
              <th><%= t(".table.split_base_number") -%></th>
              <th><%= t(".table.split_companies") -%></th>
              <th><%= t(".table.version") -%></th>
            </tr>
          </thead>
          <tbody>
            <% @users.each do |user| %>
              <% scs = user.current_user_split_cost_setting %>
              <tr>
                <td>
                  <p><%= user.clerk_code -%></p>
                  <p><%= user.chinese_name -%></p>
                  <p><%= user.position_title -%></p>
                </td>
                <td>
                  <p>集团性</p>
                  <p>上海区域</p>
                  <p>上海天华</p>
                </td>
                <td>
                  <p><%= scs&.group_rate -%>&nbsp;</p>
                  <p><%= scs&.shanghai_area -%>&nbsp;</p>
                  <p><%= scs&.shanghai_hq -%>&nbsp;</p>
                </td>
                <td>
                  <p><%= scs&.group_rate_base -%>&nbsp;</p>
                  <p><%= scs&.shanghai_area_base -%>&nbsp;</p>
                  <p><%= scs&.shanghai_hq_base -%>&nbsp;</p>
                </td>
                <td>
                  <p class="<%= scs&.user_split_cost_group_rate_companies_codes.present? ? 'mb-0' : '' -%>">
                    <% scs&.user_split_cost_group_rate_companies_codes&.each do |company_code| %>
                      <span class="badge badge-primary"><%= Bi::OrgShortName.company_short_names_by_orgcode[company_code] -%></span>
                    <% end %>
                  &nbsp;</p>
                  <p class="<%= scs&.user_split_cost_shanghai_area_rate_companies_codes.present? ? 'mb-0' : '' -%>">
                    <% scs&.user_split_cost_shanghai_area_rate_companies_codes&.each do |company_code| %>
                      <span class="badge badge-secondary"><%= Bi::OrgShortName.company_short_names_by_orgcode[company_code] -%></span>
                    <% end %>
                  &nbsp;</p>
                  <p>
                    <% scs&.user_split_cost_shanghai_hq_rate_companies_codes&.each do |company_code| %>
                      <span class="badge badge-dark"><%= Bi::OrgShortName.company_short_names_by_orgcode[company_code] -%></span>
                    <% end %>
                  &nbsp;</p>
                </td>
                <td>
                  <% if scs.present? %>
                    <%= link_to scs.version, edit_cost_split_user_split_cost_setting_path(id: scs.id), remote: true -%>
                  <% else %>
                    <%= link_to new_cost_split_user_split_cost_setting_path, remote: true do -%>
                      <i class="fas fa-file" data-toggle="tooltip" data-placement="top" title="<%= t('.action.new') -%>"></i>
                    <% end %>
                  <% end %>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div id="cost-human-resources-modal" class="modal" tabindex="-1" role="dialog"></div>
