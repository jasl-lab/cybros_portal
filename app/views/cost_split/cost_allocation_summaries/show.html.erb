<div class="row">
  <div class="col-lg-12">
    <h3 class="page-title">
      <%= t(".title") %>
    </h3>
    <div class="row">
      <div class="col-lg-12">
        <%= form_tag cost_split_cost_allocation_summary_path, method: :get, class: 'form-inline' do -%>
          <div class="form-group mr-3">
            <label class="mr-1"><%= t(".month_name") -%>：</label>
            <%= select_tag 'month_name', options_for_select(@all_month_names, @month_name), class: 'form-control' %>
          </div>
          <div>
            <%= submit_tag t(".confirm"), class: 'btn btn-primary' %>
          </div>
        <% end -%>
      </div>
      <div class="col-12 mt-2">
        <table class="table table-bordered table-responsive">
          <thead>
            <tr>
              <th colspan="2" rowspan="3"><%= t(".table.abstract") -%></th>
              <th rowspan="3"><%= t(".table.sum") -%></th>
              <% @ordered_companies.keys.each_with_index do |org_shortname, index| -%>
                <th colspan="3" style="vertical-align:middle;text-align:center;"><%= index + 1 -%></th>
              <% end %>
            </tr>
            <tr>
              <% @ordered_companies.keys.each do |org_shortname| -%>
                <th colspan="3" style="vertical-align:middle;text-align:center;"><%= org_shortname -%></th>
              <% end %>
            </tr>
            <tr>
              <% @ordered_companies.keys.each do |org_shortname| -%>
                <th>集团性</th>
                <th>上海区域</th>
                <th>纯上海天华</th>
              <% end %>
            </tr>
          </thead>
          <tbody>
            <% @ordered_depts.keys.each_with_index do |dept_name, index| %>
              <tr>
                <% if index == 0 %>
                  <td rowspan="<%= @ordered_depts.keys.count -%>" style="vertical-align:middle;text-align:center;">工资、社保、公积金、房租及物业费小计</td>
                <% end %>
                <td><%= dept_name -%></td>
                <td>0</td>
                <% @ordered_companies.keys.each do |org_shortname| -%>
                  <% uscd = @user_split_cost_details.find {|u| u.v_wata_dept_code == @ordered_depts[dept_name] && u.to_split_company_code == @ordered_companies[org_shortname] } %>
                  <% if uscd.present? %>
                    <td><%= uscd.group_cost -%></td>
                    <td><%= uscd.shanghai_area_cost -%></td>
                    <td><%= uscd.shanghai_hq_cost -%></td>
                  <% else %>
                    <td></td>
                    <td></td>
                    <td></td>
                  <% end %>
                <% end %>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
