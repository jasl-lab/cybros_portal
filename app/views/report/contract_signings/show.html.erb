<div class="row">
  <div class="col-lg-12">
    <div class="container">
      <h3 class="page-title">
        <%= t('.title') %>
      </h3>
      <%= form_tag report_contract_signing_path, method: :get, class: 'form-inline' do -%>
        <div class="form-group">
          <label class="mr-1"><%= t(".period_mean_ref") -%>：</label>
          <%= text_field_tag 'period_mean_ref', @period_mean_ref, class: 'form-control form-control2' %>
        </div>
        <div class="form-group">
          <label class="mr-1"><%= t(".month_name") -%>：</label>
          <%= select_tag 'month_name', options_for_select(@all_month_names, @month_name), class: 'form-control' %>
        </div>
        <div><%= submit_tag t(".confirm"), class: 'btn btn-primary' %></div>
      <% end -%>
      <div class="row">
        <div class="col-lg-12 m-3 p-3">
          <h5>至<%= @end_of_month.year -%>年<%= @end_of_month.month -%>月,当月归档业绩合同额<span style="color:red"><%= @sum_contract_amounts -%> 亿元</span>; 至2019年5月,本年平均签约周期 <span style="color:red"><%= @sum_avg_period_mean -%> 天</span>。</h5>
        </div>
      </div>
      <div class="row">
        <div class="col-lg-12">
          <div id="contract-signings-chart"
            data-controller="contract-signings"
            data-action="resize@window->contract-signings#layout"
            data-contract-signings-x_axis="<%= @all_company_names.to_json -%>"
            data-contract-signings-sum_contract_amounts="<%= @contract_amounts.to_json -%>"
            data-contract-signings-avg_period_mean="<%= @avg_period_mean.to_json -%>"
            data-contract-signings-avg_period_mean_max="<%= @avg_period_mean_max -%>"
            data-contract-signings-period_mean_ref="<%= @period_mean_ref -%>"
            style="width: 100%;height: 600px;">
          </div>
        </div>
      </div>
      <div class="row mt-3">
        <div class="col-lg-12">
          <table class="table table-striped table-responsive table-dark">
            <thead>
              <tr class="d-flex">
                <th scope="col" class="col-1">部门</th>
                <% @all_company_names.each do |company_name| %>
                  <th scope="col" class="col-1"><%= company_name -%></th>
                <% end %>
              </tr>
            </thead>
            <tbody>
              <tr class="d-flex">
                <th scope="row" class="col-1">本年签约周期</th>
                <% @avg_period_mean.each do |period_mean| %>
                  <td class="col-1"><%= period_mean -%></td>
                <% end %>
              </tr>
              <tr class="d-flex">
                <th scope="row" class="col-1">本年累计合同额(万元)</th>
                <% @contract_amounts.each do |contract_amount| %>
                  <td class="col-1"><%= contract_amount -%></td>
                <% end %>
              </tr>
              <tr class="d-flex">
                <th scope="row" class="col-1">人均合同额</th>
                <% @contract_amounts.each_with_index do |contract_amount, index| %>
                  <% company_name = @all_company_names[index] %>
                  <% staff_count = @staff_per_company[company_name] %>
                  <td class="col-1"><%= (contract_amount/staff_count.to_f).round(1) -%></td>
                <% end %>
              </tr>
              <tr class="d-flex">
                <th scope="row" class="col-1">平均人数</th>
                <% @contract_amounts.each_with_index do |contract_amount, index| %>
                  <% company_name = @all_company_names[index] %>
                  <% staff_count = @staff_per_company[company_name] %>
                  <td class="col-1"><%= staff_count -%></td>
                <% end %>
              </tr>

            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
