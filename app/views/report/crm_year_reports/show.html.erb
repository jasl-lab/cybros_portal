<div class="row"
  data-controller="crm-year-report"
  data-action="resize@window->crm-year-report#layout"
  data-crm-year-report-x_axis="<%= @years.to_json -%>"
  data-crm-year-report-top20s="<%= @top20s.to_json -%>"
  data-crm-year-report-top20to50s="<%= @top20to50s.to_json -%>"
  data-crm-year-report-gt50s="<%= @gt50s.to_json -%>"
  data-crm-year-report-others="<%= @others.to_json -%>">
  <div class="col-12">
    <h3 class="page-title">
      <%= t(".title") %>
    </h3>
    <%= form_tag report_crm_year_report_path, method: :get, class: 'form-inline' do -%>
      <%= hidden_field_tag 'year', @year -%>
      <div class="form-group mr-1">
        <label class="mr-1"><%= t(".org_names") -%>：</label>
        <%= select_tag 'orgs', options_for_select(@organization_options, @orgs_options), { include_blank: true, multiple: true, class: 'form-control' } %>
      </div>
      <div><%= submit_tag t(".confirm"), class: 'btn btn-thape-color' %></div>
    <% end -%>
  </div>
  <div class="col-6">
    <div id="crm-year-report-chart" style="width: 100%;height: 370px;">
    </div>
  </div>
  <div class="col-6 table-responsive">
    <table class="table table-striped mt-5">
      <thead>
        <tr>
          <th class="py-3"></th>
          <th class="py-3"><%= t('.table.top20') -%></th>
          <th class="py-3"><%= t('.table.top20to50') -%></th>
          <th class="py-3"><%= t('.table.gt50') -%></th>
          <th class="py-3"><%= t('.table.other') -%></th>
          <th class="py-3"><%= t('.table.total') -%></th>
        </tr>
      </thead>
      <tbody>
        <% @data.each do |d| %>
          <tr>
            <td class="py-3"><%= d.year -%></td>
            <td class="py-3"><%= (d.top20 / 100_0000.0).round(1) -%></td>
            <td class="py-3"><%= (d.top20to50 / 100_0000.0).round(1) -%></td>
            <td class="py-3"><%= (d.gt50 / 100_0000.0).round(1) -%></td>
            <td class="py-3"><%= (d.others / 100_0000.0).round(1) -%></td>
            <td class="py-3"><%= ((d.top20+d.top20to50+d.gt50+d.others) / 100_0000.0).round(1) -%></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="col-12 table-responsive">
    <%= form_tag report_crm_year_report_path, method: :get, class: 'form-inline' do -%>
      <%= hidden_field_tag 'orgs', @orgs_options -%>
      <div class="form-group mr-1">
        <label class="mr-1"><%= t(".year") -%>：</label>
        <%= select_tag 'year', options_for_select(@all_years, @year), { class: 'form-control form-control-plain', id: 'select-year' } %>
      </div>
      <div><%= submit_tag t(".confirm"), class: 'btn btn-thape-color' %></div>
    <% end -%>
  </div>
</div>

<div id="crm-year-report-modal" class="modal" tabindex="-1" role="dialog"></div>
