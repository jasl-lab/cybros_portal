<%- content_for :action_bar do %>
  <ol>
    <li class="action_bar-item">
      <%= link_to t('.actions.view_orgcode_sum'),
          report_complete_value_path(month_name: @month_name, view_orgcode_sum: true), class: 'btn text-primary' %>
    </li>
    <li class="action_bar-item">
      <%= link_to t('.actions.view_orgcode'),
          report_complete_value_path(month_name: @month_name), class: 'btn text-primary' %>
    </li>
  </ol>
<% end %>

<div class="row">
  <div class="col-lg-12"
    data-controller="complete-values"
    data-action="resize@window->complete-values#layout"
    data-complete-values-x_axis="<%= @all_company_short_names.to_json -%>"
    data-complete-values-complete_value_totals="<%= @complete_value_totals.to_json -%>"
    data-complete-values-complete_value_year_totals="<%= @complete_value_year_totals.to_json -%>"
    data-complete-values-complete_value_year_totals_remain="<%= @complete_value_year_totals_remain.to_json -%>"
    data-complete-values-complete_value_totals_per_staff="<%= @complete_value_totals_per_staff.to_json -%>"
    data-complete-values-complete_value_year_totals_per_staff="<%= @complete_value_year_totals_per_staff.to_json -%>">
    <h3 class="page-title">
      <%= t(".title") %>
    </h3>
    <%= form_tag report_complete_value_path, method: :get, class: 'form-inline' do -%>
      <%= hidden_field_tag :view_orgcode_sum, @view_orgcode_sum %>
      <div class="form-group">
        <label class="mr-1"><%= t(".month_name") -%>：</label>
        <%= select_tag 'month_name', options_for_select(@all_month_names, @month_name), class: 'form-control' %>
      </div>
      <div class="form-group mx-2">
        <%= check_box_tag 'show_shanghai_hq', @show_shanghai_hq, @show_shanghai_hq, class: 'form-control' %>
        <label class="mr-1"> <%= t(".show_shanghai_hq") -%></label>
      </div>
      <div><%= submit_tag t(".confirm"), class: 'btn btn-primary' %></div>
    <% end -%>
    <div class="row">
      <div class="col-lg-12 p-2">
        <h5 class="text-center">至<%= @end_of_month.year -%>年<%= @end_of_month.month -%>月,集团本年累计完成产值 <span style="color:red"><%= @fix_sum_complete_value_totals -%> 亿元</span>，本年累计人均完成产值 <span style="color:red"><%= @fix_avg_complete_value_totals_per_staff -%> 万元</span>；</h5>
        <h5 class="text-center">集团预计全年完成产值 <span style="color:red"><%= @fix_sum_complete_value_year_totals -%> 亿元</span>，预计全年人均完成产值 <span style="color:red"><%= @fix_avg_complete_value_year_totals_per_staff -%> 万元</span>。</h5>
      </div>
    </div>
    <div class="row">
      <div class="col-lg-12">
        <div id="complete-values-total-chart" style="width: 100%; height: 340px;"></div>
      </div>
      <div class="col-lg-12">
        <div id="complete-values-staff-chart" style="width: 100%; height: 340px;"></div>
      </div>
    </div>
  </div>
  <div class="col-lg-12">
    <div class="row mt-3">
      <div class="col-lg-12">
        <table class="table table-striped table-responsive table-dark">
          <thead>
            <tr class="d-flex">
              <th scope="col" class="col-1">部门</th>
              <% @all_company_short_names&.each do |short_company_name| %>
                <th scope="col" class="col-1"><%= short_company_name -%></th>
              <% end %>
            </tr>
          </thead>
          <% total_staff_num = 0 %>
          <tbody>
            <tr class="d-flex">
              <th scope="row" class="col-1">人数</th>
              <% @all_company_short_names&.each do |short_company_name| %>
                <% total_staff_num += (@staff_per_company[short_company_name] || 0) %>
                <td class="col-1"><%= @staff_per_company[short_company_name]&.round(0) -%></td>
              <% end %>
            </tr>
          </tbody>
        </table>
        <h6>表格上的总人数：<%= total_staff_num.round(0) -%></h6>
      </div>
    </div>
  </div>
  <div class="col-lg-12">
    <p>说明：</p>
    <p>1)完成产值含所有已签约项目和未签约项目：已签约项目完成产值=∑里程碑完成比例X里程碑对应产值；未签约项目完成产值=人力成本X标准产工比；</p>
    <p>2)全年完成产值=本月累计完成产值/月数*12；全年人均完成产值=全年完成产值/全年平均人数；全年平均人数为一线所有人数，包括一线管理人员；</p>
    <p>3)预计全年完成产值=本月累计完成产值/月数*12；预计全年人均完成产值=预计全年完成产值/全年平均人数；全年平均人数为一线所有人数，包括一线管理人员；</p>
  </div>
</div>
